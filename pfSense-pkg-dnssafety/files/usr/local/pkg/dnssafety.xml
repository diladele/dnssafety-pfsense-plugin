<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE packagegui SYSTEM "../schema/packages.dtd">
<?xml-stylesheet type="text/xsl" href="../xsl/package.xsl"?>
<packagegui>
	<copyright>
<![CDATA[
/*
 * dnssafety.xml
 *
 * Copyright (c) 2019 Diladele B.V.
 * All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
	]]>
	</copyright>
	<name>dnssafety</name>
	<title>DNS Safety</title>
	<include_file>/usr/local/pkg/dnssafety.inc</include_file>
	<menu>
		<name>DNS Safety</name>
		<tooltiptext>Modify DNS Safety settings</tooltiptext>
		<section>Services</section>
		<url>/pkg_edit.php?xml=dnssafety.xml</url>
	</menu>
	<service>
		<name>dsdnsd</name>
		<rcfile>dsdnsd.sh</rcfile>
		<executable>dsdnsd</executable>
		<description>DNS Safety Server</description>
	</service>
	<tabs>
		<tab>
			<text>Settings</text>
			<url>/pkg_edit.php?xml=dnssafety.xml</url>
			<active/>
		</tab>
		<tab>
			<text>Forwarders</text>
			<url>/pkg.php?xml=dnssafety_forwarder.xml</url>
		</tab>
		<tab>
			<text>Filtering Policies</text>
			<url>/pkg.php?xml=dnssafety_filter.xml</url>
		</tab>
		<tab>
			<text>Domains and Cache</text>
			<url>/pkg.php?xml=dnssafety_cache.xml</url>
		</tab>
		<tab>
			<text>Sync</text>
			<url>/pkg_edit.php?xml=dnssafety_sync.xml</url>
		</tab>
	</tabs>
	<advanced_options>enabled</advanced_options>
	<fields>
		<field>
			<type>listtopic</type>
			<name>Daemon Settings</name>
		</field>
		<field>
			<fielddescr>Enable</fielddescr>
			<fieldname>enable_dnssafety</fieldname>
			<description>Enable DNS Safety filter.</description>
			<sethelp>
				Enables or disables the startup of DNS Safety filtering daemon at /usr/local/etc/rc.d/dsdnsd.sh script.
			</sethelp>
			<type>checkbox</type>
		</field>
		<field>
			<fielddescr>Listen on</fielddescr>
			<fieldname>listenon</fieldname>
			<description>Choose the interfaces on which DNS Safety will be listening on for incoming requests. Default value - All Interfaces/IP Addresses.</description>
			<type>interfaces_selection</type>
			<showlistenall/>
			<showvirtualips/>
			<multiple/>
		</field>
		<field>
			<fielddescr>Listen port</fielddescr>
			<fieldname>listenport</fieldname>
			<description>
				<![CDATA[
				Network port DNS Safety daemon listens for incoming queries on. Remember to create firewall rules to allow queries on this port.<br />
				Note that DNS Safety runs as non-privileged <strong>daemon</strong> user and thus cannot bind to normal port 53. It is recommended to use port 5353 instead and redirect incoming DNS requests to it as described in the <a target="new" href="https://docs.dnssafety.io/install/pfsense">tutorial</a>.
				]]>
			</description>
			<type>input</type>
			<size>5</size>
			<default_value>5353</default_value>			
		</field>
		
		<field>
			<fielddescr>Listen TCP</fielddescr>
			<fieldname>listentcp</fieldname>
			<description>Listen for DNS requests on TCP port too in addition to default listening for DNS requests on UDP port.</description>
			<type>checkbox</type>
		</field>
		<field>
			<type>listtopic</type>
			<name>Logging Options</name>
		</field>
		<field>
			<fielddescr>Enable Logging</fielddescr>
			<fieldname>dnssafety_logging</fieldname>
			<description>
				<![CDATA[
				Enable dnssafety logs under Status > System logs, Resolver tab.
				]]>
			</description>
			<type>checkbox</type>
		</field>
		<field>
			<fielddescr>Logging Severity</fielddescr>
			<fieldname>log_severity</fieldname>
			<description>
				<![CDATA[
				Choose logging level for selected categories.<br />
				The value 'dynamic' means assume the global level defined by either the command line parameter -d or by running rndc trace.
				]]>
			</description>
			<type>select</type>
			<options>
				<option><name>Critical</name><value>critical</value></option>
				<option><name>Error</name><value>error</value></option>
				<option><name>Warning</name><value>warning</value></option>
				<option><name>Notice</name><value>Notice</value></option>
				<option><name>Info</name><value>info</value></option>
				<option><name>Debug level 1</name><value>debug 1</value></option>
				<option><name>Debug level 3</name><value>debug 3</value></option>
				<option><name>Debug level 5</name><value>debug 5</value></option>
				<option><name>Dynamic</name><value>dynamic</value></option>
			</options>
		</field>
		<field>
			<fielddescr>Logging Options</fielddescr>
			<fieldname>log_options</fieldname>
			<description>
				<![CDATA[
				Select categories to log.<br />
				(Use CTRL + click to select/unselect.
				]]>
			</description>
			<type>select</type>
			<options>
				<option>
					<name>Default - If this is the only category selected, it will log all categories except queries.</name>
					<value>default</value>
				</option>
				<option>
					<name>General - Anything that is not classified as any other item in this list defaults to this category.</name>
					<value>general</value>
				</option>
				<option>
					<name>Database - Messages relating to the databases used internally by the name server to store zone and cache data.</name>
					<value>database</value>
				</option>
				<option>
					<name>Security - Approval and denial of requests.</name>
					<value>security</value>
				</option>
				<option>
					<name>Config - Configuration file parsing and processing.</name>
					<value>config</value>
				</option>
				<option>
					<name>Resolver - Name resolution including recursive lookups.</name>
					<value>resolver</value>
				</option>
				<option>
					<name>Xfer-in - Details of zone transfers the server is receiving.</name>
					<value>xfer-in</value>
				</option>
				<option>
					<name>Xfer-out - Details of zone transfers the server is sending.</name>
					<value>xfer-out</value>
				</option>
				<option>
					<name>Notify - Logs all NOTIFY operations.</name>
					<value>notify</value>
				</option>
				<option>
					<name>Client - Processing of client requests.</name>
					<value>client</value>
				</option>
				<option>
					<name>Unmatched - No matching view clause or unrecognized class value.</name>
					<value>unmatched</value>
				</option>
				<option>
					<name>Queries - Logs all query transactions.</name>
					<value>queries</value>
				</option>
				<option>
					<name>Network - Logs all network operations.</name>
					<value>network</value>
				</option>
				<option>
					<name>Update - Logging of all dynamic update (DDNS) transactions.</name>
					<value>update</value>
				</option>
				<option>
					<name>Dispatch - Dispatching of incoming packets to the server modules.</name>
					<value>dispatch</value>
				</option>
				<option>
					<name>DNSSEC - DNSSEC and TSIG protocol processing.</name>
					<value>dnssec</value>
				</option>
				<option>
					<name>lame-servers - Misconfiguration in the delegation of domains discovered by dnssafety.</name>
					<value>lame-servers</value>
				</option>
			</options>
			<multiple/>
			<size>18</size>
		</field>
		<field>
			<fielddescr>Hide Version</fielddescr>
			<fieldname>dnssafety_hide_version</fieldname>
			<description>Hide the version of dnssafety (ignore queries for version.dnssafety).</description>
			<type>checkbox</type>
		</field>
		<field>
			<fielddescr>Limit Memory Use</fielddescr>
			<fieldname>dnssafety_ram_limit</fieldname>
			<description>Limits RAM use for DNS server (Recommended: 256M)</description>
			<type>input</type>
			<size>10</size>
			<default_value>256M</default_value>
		</field>
		
		<field>
			<type>listtopic</type>
			<name>Response Rate Limit</name>
		</field>
		<field>
			<fielddescr>Rate Limit</fielddescr>
			<fieldname>rate_enabled</fieldname>
			<description>Enable Rate Limit.</description>
			<sethelp>
				<![CDATA[
						 See <a href="https://kb.isc.org/article/AA-01000/189/A-Quick-Introduction-to-Response-Rate-Limiting.html">A Quick Introduction to Response Rate Limiting</a> to prevent DOS attack.
				]]>
			</sethelp>
			<type>checkbox</type>
			<enablefields>rate_limit,log_only</enablefields>
		</field>
		<field>
			<fielddescr>Limit Action</fielddescr>
			<fieldname>log_only</fieldname>
			<description>Select what to do when a query reaches a limit.</description>
			<type>select</type>
			<options>
				<option><name>Deny query</name><value>no</value></option>
				<option><name>Log only</name><value>yes</value></option>
			</options>
		</field>
		<field>
			<fielddescr>Limit</fielddescr>
			<fieldname>rate_limit</fieldname>
			<description>Set rate limit. (Default: 15)</description>
			<type>input</type>
			<size>10</size>
		</field>
		<field>
			<type>listtopic</type>
			<name>Forwarder Configuration</name>
		</field>
		<field>
			<fielddescr>Enable Forwarding</fielddescr>
			<fieldname>dnssafety_forwarder</fieldname>
			<description>Enable forwarding queries to other DNS servers listed below rather than this server performing its own recursion.</description>
			<type>checkbox</type>
			<enablefields>dnssafety_forwarder_ips</enablefields>
		</field>
		<field>
			<fielddescr>Forwarder IPs</fielddescr>
			<fieldname>dnssafety_forwarder_ips</fieldname>
			<description>
				<![CDATA[
				Enter IPs of DNS servers to use for recursion. Separate by semi-colons (;).<br />
				Please also add a semi-colon (;) behind the last entry<br />
				Applies only if Enable Forwarding is chosen.
				]]>
			</description>
			<type>input</type>
			<size>80</size>
		</field>
		<field>
			<fielddescr>Control port</fielddescr>
			<fieldname>controlport</fieldname>
			<description>
				<![CDATA[
				TCP port dnssafety listens for control requests on (localhost only).<br />
				Must be changed if also running DNS Forwarder or Resolver on this Firewall.
				]]>
			</description>
			<type>input</type>
			<size>5</size>
			<default_value>953</default_value>
			<advancedfield/>
		</field>
		<field>
			<fielddescr>Custom Options</fielddescr>
			<fieldname>dnssafety_custom_options</fieldname>
			<description>
				<![CDATA[
				You can put your own custom options here, one per line. They'll be added to the configuration.<br />
				They need to be <a href="http://www.freebsd.org/cgi/man.cgi?query=named.conf&apropos=0&sektion=0&manpath=FreeBSD+10.1-RELEASE+and+Ports&arch=default&format=html">named.conf</a> native settings.
				]]>
			</description>
			<type>textarea</type>
			<cols>65</cols>
			<rows>5</rows>
			<encoding>base64</encoding>
			<advancedfield/>
		</field>
		<field>
			<fielddescr>Global Settings</fielddescr>
			<fieldname>dnssafety_global_settings</fieldname>
			<description>
				<![CDATA[
				You can put your own global settings here. They'll be added to the configuration.<br />
				They need to be <a href="http://www.freebsd.org/cgi/man.cgi?query=named.conf&apropos=0&sektion=0&manpath=FreeBSD+10.1-RELEASE+and+Ports&arch=default&format=html">named.conf</a> native settings.
				]]>
			</description>
			<type>textarea</type>
			<cols>65</cols>
			<rows>5</rows>
			<encoding>base64</encoding>
			<advancedfield/>
		</field>
	</fields>
	<custom_php_resync_config_command>
		dnssafety_sync();
	</custom_php_resync_config_command>
	<custom_php_install_command>
		dnssafety_write_rcfile();
	</custom_php_install_command>
</packagegui>
